pipeline {
    agent any

    tools {
        maven "test-maven"   // Jenkins'te Maven tanımlıysa kullan
    }

    environment {
        TOMCAT_URL = 'http://192.168.1.3:9000'
        DEPLOY_CRED = credentials('tomcat-cred') // Jenkins credentials ID
    }

    stages {
        stage('Checkout') {
            steps {
                git branch: 'main',
                    url: 'https://github.com/createand/jaxbmevzuat.git'
            }
        }

        stage('Build') {
            steps {
                sh 'mvn clean package -DskipTests'
            }
        }

        /*stage('Deploy to Tomcat') {
            steps {
                deploy adapters: [
                    tomcat9(
                        credentialsId: "tomcat-cred",
                        path: '/jaxbmevzuat',
                        url: "${TOMCAT_URL}"
                    )
                ],
                contextPath: '/jaxbmevzuat',
                war: 'target/jaxbmevzuat.war'
            }
        }*/
        
         stage('Deploy to Tomcat') {
            steps {
                withCredentials([usernamePassword(
                    credentialsId: 'tomcat-cred',
                    usernameVariable: 'TOMCAT_USER',
                    passwordVariable: 'TOMCAT_PASS'
                )]) {
                    sh """
                    curl -s -o /dev/null -w "%{http_code}" \\
                         -u $TOMCAT_USER:$TOMCAT_PASS \\
                         --upload-file target/jaxbmevzuat.war \\
                         "$TOMCAT_URL/manager/text/deploy?path=/jaxbmevzuat&update=true"
                    """
                }
            }
         }
    }
}